## Лаба 8. Рекомендательная система фильмов MovieLens — 1

##### [![New Professions Lab — Big Data 10](/extra/images/npl7.svg)](https://github.com/newprolab/content_bigdata10)

### Дедлайн

⏰ Четверг, 06 июня 2019 года, 23:59.

### Задача

По имеющимся данным о рейтингах фильмов (MovieLens: 100 000 рейтингов) построить коллаборативную рекомендательную систему. Первая часть (эта лаба) — это подсчёт агрегированных статистик и построение User-User Recommender System на основе коллаборативной фильтрации.

#### Обработка данных на вход

Имеются следующие входные данные:
* Таблица `users * films` с рейтингами. Архив с датасетом нужно скачать с сайта GroupLens: http://files.grouplens.org/datasets/movielens/ml-100k.zip. Это тот же датасет, что и был у вас в [Лабе 6](../lab06/lab06.md), поэтому можете просто взять данные оттуда. Файл `u.data` содержит все оценки, а файл `u.item` — список всех фильмов.
* `id` выданного вам пользователя для расчёта — в вашем Личном кабинете на странице [Лабы 8](http://lk.newprolab.com/lab/laba08).

#### Обработка данных на выход

**Часть1. Основные характеристики данных MovieLens:**

1. Найдите количество всех пользователей и количество всех фильмов в данных (общее число пользователей и фильмов в датасете).
2. Сколько пользователь в среднем ставит рейтингов? Подсчитать `количество рейтингов / количество пользователей`. 
   Поле `average_user_ratings`.
3. Сколько фильм в среднем имеет рейтингов?  Подсчитать`количество рейтингов / количество фильмов`. 
   Поле `average_film_ratings`.
4. Найдите процент заполненных ячеек в данных: `количество рейтингов / (количество пользователей * количество фильмов)`. 
   Поле `completeness`.
5. Какой тип CF вы бы использовали на данном датасете? Ответ не оценивается:
* user-user
* item-item

**Часть 2. User-user CF:**

1. Для каждого пользователя найдите его средний рейтинг (сумма рейтингов пользователя/количество рейтингов пользователя). Здесь I<sub>a</sub> — множество фильмов, по которым у пользователя есть рейтинги r<sub>ui</sub>. Здесь и далее |I<sub>a</sub>| обозначает количество элементов в множестве I<sub>a</sub>.

<img width="100px" src="images/laba08_r_a_avg.png">

Для выданного вам пользователя (ID в личном кабинете):

2. Посчитайте меру близости Пирсона выданного вам пользователя со всеми остальными пользователями. Обратите внимание, что корреляция Пирсона считается только на пересечении, то есть вклад вносят только фильмы, оцененные совместно (I<sub>a</sub>, I<sub>u</sub> — множества оцененных пользователями `a` и `u` фильмов). Корреляция с константой (ситуация, когда у пользователя все оценки одинаковые) равна нулю.

Формат: `ID пользователя; корреляция Пирсона`.

<img width="350px" src="images/laba08_pearson.png">

3. Посчитайте поправочный коэффициент для корреляции Пирсона на нехватку данных:

<img width="150px" src="images/laba08_reg_coef.png">

4. Найдите 30 ближайших пользователей-соседей данного пользователя (`pearson_neighbours`), используя поправленную корреляцию Пирсона: 

<img width="500px" src="images/laba08_pearson_reg_coef.png">

Дальше мы будем использовать только этих соседей для прогноза. Заметим, что строя предсказание для некоторого фильма, мы из фиксированных 30 ближайших пользователей-соседей выбираем только тех, у кого есть оценки для данного фильма, то есть используемых пользователей-соседей для прогноза может быть сильно меньше. Можно находить k ближайших пользователей-соседей, у которых есть оценки по интересующему нас фильму, но это вычислительно гораздо сложнее, поэтому целесообразность этого следует проверять на практике (в рамках данной лабораторной, это лишнее усложнение). 

5. Для всех фильмов найдите прогноз оценки по формуле ниже. Здесь *N(a)* — множество пользователей-соседей, *s(a,u)* — мера близости пользователей из предыдущих пунктов, *|s(a,u)|* — модуль меры близости. 

<img width="250px" src="images/laba08_user_user_cf.png">

6. Рекомендуйте пользователю 10 фильмов (`pearson_top10`), которые он еще не оценивал, с самыми высокими прогнозами из предыдущего пункта.

7. Сравните результат с топ-10 фильмами, полученными по нижней границе доверительного интервала Wilson - поле `top10_lower` из Лабы 6S. Найдите количество общих фильмов в этих двух десятках. 

#### Проверка
Результат следует сохранить в файл `lab08.json` в своей домашней директории в следующем формате:
```
{
    "average_film_ratings": 89.2222,
    "average_user_ratings": 156.4444,
    "completeness": 0.093434,
    "pearson_neighbours": [123, 768, 174, 82, 457, 600, 83, 577, 22, 26, 348, 397, 615, 222, 881, 57, 719, 847, 831, 541, 452, 69, 87, 619, 456, 95, 789, 402, 303, 622],
    "pearson_top10": [1137, 1167, 481, 525, 165, 494, 863, 1427, 968, 1282]
}
```

При равенстве соответствующих метрик сортировать необходимо по возрастанию `id`, рассматривать его нужно как число.

Округление метрик — до 4 знаков после запятой.

Для получения `True` по двум последним ключам **точность совпадения должна быть не менее 0.8**.

Проверка осуществляется [автоматическим скриптом](http://lk.newprolab.com/lab/laba08) из Личного кабинета.
